<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: TiledSprite.js</title>
    
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="https://fonts.googleapis.com/css?family=Libre+Franklin:400,700" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/main.css">
    
    
    <script>
    var config = {"monospaceLinks":false,"cleverLinks":false,"applicationName":"phina-extensions","default":{"outputSourceFiles":true}};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">phina-extensions</a></h3>
    <button id="menuToggle" class="btn btn-link btn-lg menu-toggle">
        <span class="glyphicon glyphicon-menu-hamburger"></span>
    </button>
    <div class="search">
        <input id="search" type="text" class="form-control input-md" placeholder="Search...">
    </div>
    <ul class="list">
    
        <li class="item" data-name="phina">
            <span class="title namespace ">
                
                <span class="namespaceTag">
                    <span class="glyphicon glyphicon-folder-open"></span>
                </span>
                
                <a href="phina.html">phina</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.accessory">
            <span class="title namespace ">
                
                <span class="namespaceTag">
                    <span class="glyphicon glyphicon-folder-open"></span>
                </span>
                
                <a href="phina.accessory.html">phina.accessory</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.display">
            <span class="title namespace ">
                
                <span class="namespaceTag">
                    <span class="glyphicon glyphicon-folder-open"></span>
                </span>
                
                <a href="phina.display.html">phina.display</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.game">
            <span class="title namespace ">
                
                <span class="namespaceTag">
                    <span class="glyphicon glyphicon-folder-open"></span>
                </span>
                
                <a href="phina.game.html">phina.game</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.ui">
            <span class="title namespace ">
                
                <span class="namespaceTag">
                    <span class="glyphicon glyphicon-folder-open"></span>
                </span>
                
                <a href="phina.ui.html">phina.ui</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="global">
            <span class="title namespace ">
                
                <span class="namespaceTag">
                    <span class="glyphicon glyphicon-globe"></span>
                </span>
                
                <a href="global.html">Global</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            <span class="subtitle">Typedefs</span>
            
                <li class="parent" data-name="SceneItem"><a href="global.html#SceneItem">SceneItem</a></li>
            
                <li class="parent" data-name="StateObject"><a href="global.html#StateObject">StateObject</a></li>
            
                <li class="parent" data-name="Vector2"><a href="global.html#Vector2">Vector2</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  status-deprecated" data-name="_updatePosition"><a href="global.html#_updatePosition">_updatePosition</a></li>
            
                <li class="parent  " data-name="flowerPath"><a href="global.html#flowerPath">flowerPath</a></li>
            
                <li class="parent  " data-name="registerState"><a href="global.html#registerState">registerState</a></li>
            
                <li class="parent  " data-name="setState"><a href="global.html#setState">setState</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.accessory.AfterImage">
            <span class="title  ">
                
                <a href="phina.accessory.AfterImage.html">phina.accessory.AfterImage</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="phina.accessory.AfterImage#_toTexture"><a href="phina.accessory.AfterImage.html#_toTexture">_toTexture</a></li>
            
                <li class="parent  " data-name="phina.accessory.AfterImage#poolImage"><a href="phina.accessory.AfterImage.html#poolImage">poolImage</a></li>
            
                <li class="parent  " data-name="phina.accessory.AfterImage#remove"><a href="phina.accessory.AfterImage.html#remove">remove</a></li>
            
                <li class="parent  " data-name="phina.accessory.AfterImage#setVisible"><a href="phina.accessory.AfterImage.html#setVisible">setVisible</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.accessory.Automaton">
            <span class="title  ">
                
                <a href="phina.accessory.Automaton.html">phina.accessory.Automaton</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.accessory.Drawer">
            <span class="title  ">
                
                <a href="phina.accessory.Drawer.html">phina.accessory.Drawer</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="phina.accessory.Drawer#hide"><a href="phina.accessory.Drawer.html#hide">hide</a></li>
            
                <li class="parent  " data-name="phina.accessory.Drawer#show"><a href="phina.accessory.Drawer.html#show">show</a></li>
            
                <li class="parent  " data-name="phina.accessory.Drawer#toggle"><a href="phina.accessory.Drawer.html#toggle">toggle</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.accessory.Fader">
            <span class="title  ">
                
                <a href="phina.accessory.Fader.html">phina.accessory.Fader</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="phina.accessory.Fader#hide"><a href="phina.accessory.Fader.html#hide">hide</a></li>
            
                <li class="parent  " data-name="phina.accessory.Fader#pulse"><a href="phina.accessory.Fader.html#pulse">pulse</a></li>
            
                <li class="parent  " data-name="phina.accessory.Fader#show"><a href="phina.accessory.Fader.html#show">show</a></li>
            
                <li class="parent  " data-name="phina.accessory.Fader#toggle"><a href="phina.accessory.Fader.html#toggle">toggle</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.display.AnimationSprite">
            <span class="title  ">
                
                <a href="phina.display.AnimationSprite.html">phina.display.AnimationSprite</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="phina.display.AnimationSprite#setAnimation"><a href="phina.display.AnimationSprite.html#setAnimation">setAnimation</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.display.DashedLineShape">
            <span class="title  ">
                
                <a href="phina.display.DashedLineShape.html">phina.display.DashedLineShape</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.display.FlowerShape">
            <span class="title  ">
                
                <a href="phina.display.FlowerShape.html">phina.display.FlowerShape</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.display.PetalShape">
            <span class="title  ">
                
                <a href="phina.display.PetalShape.html">phina.display.PetalShape</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.display.ScrollLayer">
            <span class="title  ">
                
                <a href="phina.display.ScrollLayer.html">phina.display.ScrollLayer</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="phina.display.ScrollLayer#setCoordinate"><a href="phina.display.ScrollLayer.html#setCoordinate">setCoordinate</a></li>
            
                <li class="parent  " data-name="phina.display.ScrollLayer#setLock"><a href="phina.display.ScrollLayer.html#setLock">setLock</a></li>
            
                <li class="parent  " data-name="phina.display.ScrollLayer#setTarget"><a href="phina.display.ScrollLayer.html#setTarget">setTarget</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.display.TiledSprite">
            <span class="title  ">
                
                <a href="phina.display.TiledSprite.html">phina.display.TiledSprite</a>
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li class="parent " data-name="phina.display.TiledSprite#frameIndex"><a href="phina.display.TiledSprite.html#frameIndex">frameIndex</a></li>
            
                <li class="parent " data-name="phina.display.TiledSprite#image"><a href="phina.display.TiledSprite.html#image">image</a></li>
            
                <li class="parent " data-name="phina.display.TiledSprite#offsetX"><a href="phina.display.TiledSprite.html#offsetX">offsetX</a></li>
            
                <li class="parent " data-name="phina.display.TiledSprite#offsetY"><a href="phina.display.TiledSprite.html#offsetY">offsetY</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="phina.display.TiledSprite#setFrameIndex"><a href="phina.display.TiledSprite.html#setFrameIndex">setFrameIndex</a></li>
            
                <li class="parent  " data-name="phina.display.TiledSprite#setImage"><a href="phina.display.TiledSprite.html#setImage">setImage</a></li>
            
                <li class="parent  " data-name="phina.display.TiledSprite#setOffset"><a href="phina.display.TiledSprite.html#setOffset">setOffset</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.game.Sequence">
            <span class="title  ">
                
                <a href="phina.game.Sequence.html">phina.game.Sequence</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.ui.DebugLabel">
            <span class="title  ">
                
                <a href="phina.ui.DebugLabel.html">phina.ui.DebugLabel</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="phina.ui.DebugLabel#clear"><a href="phina.ui.DebugLabel.html#clear">clear</a></li>
            
                <li class="parent  " data-name="phina.ui.DebugLabel#subscribe"><a href="phina.ui.DebugLabel.html#subscribe">subscribe</a></li>
            
                <li class="parent  " data-name="phina.ui.DebugLabel#updateLabel"><a href="phina.ui.DebugLabel.html#updateLabel">updateLabel</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.ui.ScrollableLabelArea">
            <span class="title  ">
                
                <a href="phina.ui.ScrollableLabelArea.html">phina.ui.ScrollableLabelArea</a>
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li class="parent " data-name="phina.ui.ScrollableLabelArea#canvasHeight"><a href="phina.ui.ScrollableLabelArea.html#canvasHeight">canvasHeight</a></li>
            
                <li class="parent " data-name="phina.ui.ScrollableLabelArea#textAreaHeight"><a href="phina.ui.ScrollableLabelArea.html#textAreaHeight">textAreaHeight</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="phina.ui.ScrollableLabelArea#addLine"><a href="phina.ui.ScrollableLabelArea.html#addLine">addLine</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="TiledSprite.js.html">Source: TiledSprite.js</h1>
        


    
    <section>
        <header>
            <div class="header content-size">
                <h2>TiledSprite.js</h2>
            </div>
        </header>
        <article>
            <pre id="source-code" class="prettyprint source "><code>
/**
 * 指定したスプライトをタイル状にリピード描画する。&lt;br>
 * 背景スクロールなどに使用。
 * @see https://qiita.com/pentamania/items/ab736338d7b3b81b94cd
 * @class phina.display.TiledSprite
 * @memberOf phina.display
 * @extends phina.display.DisplayElement
 *
 * @example
 * // 背景をx軸スクロールする
 * const SCROLL_SPEED = 4;
 * const bgImage = phina.display.TiledSprite("background")
 *   .addChildTo(this)
 *   .on('enterframe', function() {
 *     this.offsetX -= SCROLL_SPEED;
 *   })
 * ;
 *
 * @param {String | phina.asset.Texture | phina.graphics.Canvas} image
 * @param {Number} [width]
 * @param {Number} [height]
 */
export default phina.createClass({
  superClass: phina.display.DisplayElement,

  init: function(image, width, height) {
    this.superInit();

    this._tileWidth = 0;
    this._tileHeight = 0;
    this._image = null;
    this._tempCanvas = phina.graphics.Canvas();
    this._canvasPattern = null;
    this.srcRect = phina.geom.Rect();
    this.offset = phina.geom.Vector2(0, 0);

    this.setImage(image, width, height);
  },

  /**
   * 画像をセット
   * @override
   * @instance
   * @memberOf phina.display.TiledSprite
   *
   * @param {String | phina.asset.Texture | phina.graphics.Canvas} image
   * @param {Number} [width]
   * @param {Number} [height]
   * @return {this}
   */
  setImage: function(image, width, height) {
    if (typeof image === 'string') {
      image = phina.asset.AssetManager.get('image', image);
    }
    this._image = image;
    this.width = this._image.domElement.width;
    this.height = this._image.domElement.height;

    if (width) { this.width = width; }
    if (height) { this.height = height; }
    this._tileWidth = this.width;
    this._tileHeight = this.height;

    this.frameIndex = 0; // run setFrameIndex

    return this;
  },

  /**
   * indexに応じてタイル化範囲をセット
   * @override
   * @instance
   * @memberOf phina.display.TiledSprite
   *
   * @param {Number} index
   * @param {Number} [width] タイル幅
   * @param {Number} [height] タイル高さ
   * @return {this}
   */
  setFrameIndex: function(index, width, height) {
    var tw  = width || this._tileWidth || this._width;
    var th  = height || this._tileHeight || this._height;
    var row = ~~(this.image.domElement.width / tw);
    var col = ~~(this.image.domElement.height / th);
    var maxIndex = row*col;
    index = index%maxIndex;

    var x = index%row;
    var y = ~~(index/row);
    this.srcRect.x = x*tw;
    this.srcRect.y = y*th;
    this.srcRect.width  = tw;
    this.srcRect.height = th;

    this._frameIndex = index;

    this._tileWidth = tw;
    this._tileHeight = th;
    this._renderPattern();

    return this;
  },

  /**
   * 原点オフセットを一括セット
   * @instance
   * @memberOf phina.display.TiledSprite
   *
   * @param {Number} x
   * @param {Number} y
   * @return {this}
   */
  setOffset: function(x, y) {
    this.offset.x = x;
    this.offset.y = y;
    return this;
  },

  /**
   * パターン元となるタイル画像を内部キャンバスに描画
   * @private
   * @instance
   * @memberOf phina.display.TiledSprite
   *
   * @return {void}
   */
  _renderPattern: function() {
    var tempCanvas = this._tempCanvas;
    var image = this.image.domElement;
    var srcRect = this.srcRect;
    tempCanvas.clear().setSize(srcRect.width, srcRect.height);
    tempCanvas.drawImage(image,
      srcRect.x, srcRect.y, srcRect.width, srcRect.height,
      0, 0, srcRect.width, srcRect.height
    );
    this._canvasPattern = tempCanvas.context.createPattern(tempCanvas.canvas, 'repeat');
  },

  /**
   * 描画処理。rendererによって毎フレーム実行される
   * @private
   * @override
   * @instance
   * @memberOf phina.display.TiledSprite
   *
   * @param {phina.graphics.Canvas} canvas rendererのcanvas
   * @return {void}
   */
  draw: function(canvas) {
    var context = canvas.context;
    context.fillStyle = this._canvasPattern;
    context.translate(
      -this._width * this.originX - this.offset.x,
      -this._height * this.originY - this.offset.y
    );
    context.fillRect(this.offset.x, this.offset.y, this._width, this._height);
  },

  _accessor: {

    /**
     * 画像テクスチャ
     * @instance
     * @memberOf phina.display.TiledSprite
     * @type {phina.asset.Texture | phina.graphics.Canvas}
     */
    image: {
      get: function() { return this._image; },
      set: function(v) { this.setImage(v); }
    },

    /**
     * テクスチャをフレーム分割していた場合のインデックス
     * @instance
     * @memberOf phina.display.TiledSprite
     * @type {number}
     */
    frameIndex: {
      get: function() { return this._frameIndex; },
      set: function(idx) { this.setFrameIndex(idx); }
    },

    /**
     * x軸原点オフセット
     * @instance
     * @memberOf phina.display.TiledSprite
     * @type {number}
     */
    offsetX: {
      get: function() { return this.offset.x; },
      set: function(v) { this.offset.x = v; }
    },

    /**
     * y軸原点オフセット
     * @instance
     * @memberOf phina.display.TiledSprite
     * @type {number}
     */
    offsetY: {
      get: function() { return this.offset.y; },
      set: function(v) { this.offset.y = v; }
    },
  },

});</code></pre>
        </article>
    </section>






        

        <footer class="content-size">
            <div class="footer">
                Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Mon Nov 25 2019 22:17:26 GMT+0900 (GMT+09:00)
            </div>
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/main.js"></script>
</body>
</html>
